# TSOS Project Progress

## Date: 05.09.2024

### Overview
This document outlines the core concepts of interrupts and their handling in the TSOS project, including the Interrupt Descriptor Table (IDT), types of interrupts, and how IRQs and the Programmable Interrupt Controller (PIC) are involved in managing interrupt requests. This is essential for proper system management and responsiveness to hardware and software events.

### 1. **What is IDT and Why Are We Initializing It?**
- **IDT (Interrupt Descriptor Table)**:
    - The IDT is a table that tells the CPU how to handle interrupts and exceptions. It maps each interrupt number (from 0 to 255) to a specific **Interrupt Service Routine (ISR)** that deals with the interrupt.
    - **Why Initialization is Necessary**: Initializing the IDT is critical to ensure that the CPU knows where to jump when handling various types of interrupts, such as hardware interrupts, software interrupts, and exceptions. Without this, the system cannot respond properly to external or internal events, leading to crashes or undefined behavior.

### 2. **Types of Interrupts: Exceptions, IRQ, Software Interrupts**

- **Exceptions**:
    - Exceptions occur due to internal CPU events, such as dividing by zero or invalid memory access.
    - **Examples**: Divide error (INT 0), Page fault (INT 14).
    - These are usually critical and must be handled by the OS to ensure the system doesn't crash.

- **IRQ (Interrupt Request)**:
    - IRQs are hardware-generated interrupts sent by devices like the keyboard, mouse, or hard drive.
    - **Examples**: 
        - IRQ0: System Timer
        - IRQ1: Keyboard
        - IRQ14: Primary ATA Hard Disk
    - These interrupts must be acknowledged by the PIC (Programmable Interrupt Controller) and passed to the CPU for handling.

- **Software Interrupts**:
    - These are generated by software via instructions like `INT n`. It is often used for system calls or triggering specific OS-level routines.
    - **Example**: A software interrupt using `INT 0x80` in Linux is used for system calls.

### 3. **What is IRQ?**
- **IRQ (Interrupt Request)**:
    - An IRQ is a signal sent from a hardware device to the CPU, indicating that the device requires attention. These are essential for real-time hardware management, allowing the CPU to pause its current task and handle device requests such as keyboard input or disk operations.
    - **Handling IRQs**: Each IRQ is mapped to a specific ISR. When a device triggers an IRQ, the corresponding ISR is invoked to handle the interrupt.

### 4. **What is PIC – Master and Slave, How Are These Chips Connected to IRQ?**
- **PIC (Programmable Interrupt Controller)**:
    - The PIC is responsible for managing hardware interrupts (IRQs). It aggregates all hardware interrupts and passes them to the CPU in an orderly manner.
    - **Master and Slave PIC**:
        - **Master PIC**: Handles IRQ0 to IRQ7.
        - **Slave PIC**: Handles IRQ8 to IRQ15 and is connected to IRQ2 of the master PIC. This allows cascading of interrupts, enabling the system to handle more than 8 IRQs.
    - **Connection to IRQ**: Each hardware device is connected to a specific IRQ line, which is routed through the PIC. The PIC then sends the corresponding interrupt signal to the CPU based on priority.

### 5. **How Everything is Handled – IRQ, ISR, IDT, EOI**
- **IRQ Handling**:
    - When an IRQ is triggered, the PIC sends a signal to the CPU. The CPU looks at the **IDT** to find the corresponding **ISR**.
    - The ISR is responsible for addressing the interrupt (e.g., reading keyboard input or processing a disk request) and then sending an **End of Interrupt (EOI)** signal back to the PIC, allowing further interrupts to be processed.

- **ISR (Interrupt Service Routine)**:
    - The ISR is a function that handles a specific interrupt. It is defined in the IDT and is executed when the corresponding interrupt is triggered. Each ISR has its specific tasks, such as saving the CPU state, processing the interrupt, and restoring the CPU state.

- **IDT's Role**:
    - The IDT connects IRQ numbers (or other interrupt vectors) to their respective ISRs. Once an interrupt occurs, the CPU consults the IDT to find the memory location of the ISR that handles that particular interrupt.
- **EOI**:
    - After the IRQ end we need to send a signal to the hardware through the PIC that the interrupt has ended otherwise we will it will send another one, we send the EOI (end of intterupt) at the durint the ISR.    
    - **Example Flow**: 
        - IRQ1 (keyboard interrupt) is triggered.
        - PIC sends the IRQ1 signal to the CPU.
        - CPU looks up the IDT to find the ISR for IRQ1.
        - ISR processes the keyboard input.
        - ISR sends an EOI signal to the PIC.

### Conclusion
This system of interrupts—using the IDT, PIC, IRQs, and ISRs—forms the backbone of how the CPU manages external events, ensuring that devices are handled in a timely and organized manner. Understanding this structure is vital for the smooth operation of the TSOS project as it transitions into more complex functionality.